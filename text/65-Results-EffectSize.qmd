
### Effect size estimates {#effect-sizes}
Transformations --- even monotonic ones --- alter both the absolute magnitude of effects and the total variance of the data. A natural question, therefore, is how to interpret effect size estimates derived from rank transformations and whether such estimates are meaningful and comparable across methods. Nevertheless, @Kay:art-effect-sizes provides a tutorial for deriving standardized effect sizes from ART, and many of the papers we reviewed report such estimates. This practice motivates a more systematic investigation.

**Log-normal distributions.** We begin by examining log-normal responses. Consider a $4 \times 3$ within-subject design with $n = 20$, in which the effect of the first factor $X_1$ is null ($a_1 = 0$) and there is no interaction ($a_{12} = 0$). @fig-eta-squared displays the partial $\eta^2$ estimates produced by each method for the effect of $X_1$ as the magnitude of the effect on the second factor $X_2$ increases. These estimates are compared to those from a ground-truth analysis, defined here as ANOVA applied to the log-transformed responses.

::: {#fig-eta-squared}
```{r, echo=FALSE, warning=FALSE, fig.height=3.5, fig.width=8}
data <- read.csv("results/eta_squared.csv", sep=",", header=TRUE, strip.white=TRUE)
data <- data[data$family == "lnorm", ]
data$effectX2 <- factor(data$effectX2)

ylab = "X1 - partial eta squared"
xlab = "X2 - magnitude of main effect (a2)"

margins <- list(l = 50, r = 0, b = 60, t = 0, pad = 0)
cbPalette = c("#8888ff", "#888888", "#E69F00", "#009E73", "#FF5E00")
cbPalette2 = c("#8888ff88", "#88888888", "#E69F0088", "#009E7388", "#FF5E0088")

df <- data[data$effectX1 == 0,]

fig1 <- plot_ly(df, x = ~effectX2, y = ~grtX1, type = 'box', boxpoints = 'all', name = 'ground truth', hovertemplate = " ", marker = list(color = cbPalette2[1]), fillcolor = cbPalette2[1], line = list(color = cbPalette[1]))  %>% layout(xaxis = list(title = NA))
fig.par <- plot_ly(df, x = ~effectX2, y = ~parX1, type = 'box', boxpoints = 'all', name = 'PAR', hovertemplate = " ", marker = list(color = cbPalette2[2]), fillcolor = cbPalette2[2], line = list(color = cbPalette[2])) %>% layout(xaxis = list(title = NA))
fig.rnk <- plot_ly(df, x = ~effectX2, y = ~rnkX1, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'RNK', marker = list(color = cbPalette2[3]), fillcolor = cbPalette2[3], line = list(color = cbPalette[3])) %>% layout(xaxis = list(title = NA))
fig.int <- plot_ly(df, x = ~effectX2, y = ~intX1, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'INT', marker = list(color = cbPalette2[4]), fillcolor = cbPalette2[4], line = list(color = cbPalette[4])) %>% layout(xaxis = list(title = NA))
fig.art <- plot_ly(df, x = ~effectX2, y = ~artX1, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'ART', marker = list(color = cbPalette2[5]), fillcolor = cbPalette2[5], line = list(color = cbPalette[5])) %>% layout(xaxis = list(title = NA))

fig <- subplot(fig1, fig.par, fig.rnk, fig.int, fig.art, shareX = TRUE, shareY = T) %>% 
  layout(annotations = list(x = 0.5, y = -0.25, yshift = 0, xref = "paper", yref = "paper", xanchor = "center", yanchor = "bottom", showarrow = F, text = xlab), margin = margins) %>%
	config(displayModeBar = TRUE, scrollZoom = TRUE, displaylogo = FALSE, modeBarButtonsToRemove = c("lasso2d", "select2d",  "zoomIn2d", "zoomOut2d", "autoscale")) %>%  layout(legend = list(orientation = 'h', yanchor="bottom", xanchor="center", y = 1.2, x = .5, colors = cbPalette), yaxis = list(title = ylab)) %>% layout(
    hovermode = "x unified",  # Shared hover on the x-axis
    yaxis = list(spikemode = "across", spikesnap = "cursor"),
    xaxis = list(fixedrange=T)
  )

fig
```
Boxplots summarizing the partial $\eta^2$ estimates obtained with each method from 300 simulated datasets ($n=20$). The population effect of $X1$ is null, and responses follow **log-normal distributions**. Hover over the plots to compare the methods.
:::

We observe that ART is the only method for which the estimated effect sizes for $X_1$ are influenced by the magnitude of the effect on $X_2$. These results clearly demonstrate that ART's alignment mechanism fails in nonlinear models with skewed distributions and leads to confounding across effects. 

@fig-eta-squared-2 presents partial $\eta^2$ estimates when the effect of $X_1$ is no longer null ($a_1 = 1$). PAR performs poorly for these data, consistently underestimating effect sizes. RNK also slightly underestimates effects. ART also tends to underestimate effects when $a_2 = 0$; however, as $a_2$ increases, its estimates become more variable and exhibit an overall tendency to increase. INT yields the most precise estimates and is only mildly affected when $a_2 = 8$.

::: {#fig-eta-squared-2}
```{r, echo=FALSE, warning=FALSE, fig.height=3.5, fig.width=8}
df <- data[data$effectX1 == 1,]

fig1 <- plot_ly(df, x = ~effectX2, y = ~grtX1, type = 'box', boxpoints = 'all', name = 'ground truth', hovertemplate = " ", marker = list(color = cbPalette2[1]), fillcolor = cbPalette2[1], line = list(color = cbPalette[1]))  %>% layout(xaxis = list(title = NA))
fig.par <- plot_ly(df, x = ~effectX2, y = ~parX1, type = 'box', boxpoints = 'all', name = 'PAR', hovertemplate = " ", marker = list(color = cbPalette2[2]), fillcolor = cbPalette2[2], line = list(color = cbPalette[2])) %>% layout(xaxis = list(title = NA))
fig.rnk <- plot_ly(df, x = ~effectX2, y = ~rnkX1, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'RNK', marker = list(color = cbPalette2[3]), fillcolor = cbPalette2[3], line = list(color = cbPalette[3])) %>% layout(xaxis = list(title = NA))
fig.int <- plot_ly(df, x = ~effectX2, y = ~intX1, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'INT', marker = list(color = cbPalette2[4]), fillcolor = cbPalette2[4], line = list(color = cbPalette[4])) %>% layout(xaxis = list(title = NA))
fig.art <- plot_ly(df, x = ~effectX2, y = ~artX1, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'ART', marker = list(color = cbPalette2[5]), fillcolor = cbPalette2[5], line = list(color = cbPalette[5])) %>% layout(xaxis = list(title = NA))

fig <- subplot(fig1, fig.par, fig.rnk, fig.int, fig.art, shareX = TRUE, shareY = T) %>% 
  layout(annotations = list(x = 0.5, y = -0.25, yshift = 0, xref = "paper", yref = "paper", xanchor = "center", yanchor = "bottom", showarrow = F, text = xlab), margin = margins) %>%
	config(displayModeBar = TRUE, scrollZoom = TRUE, displaylogo = FALSE, modeBarButtonsToRemove = c("lasso2d", "select2d",  "zoomIn2d", "zoomOut2d", "autoscale")) %>%  layout(legend = list(orientation = 'h', yanchor="bottom", xanchor="center", y = 1.2, x = .5, colors = cbPalette), yaxis = list(title = ylab)) %>% layout(
    hovermode = "x unified",  # Shared hover on the x-axis
    yaxis = list(spikemode = "across", spikesnap = "cursor"),
    xaxis = list(fixedrange=T)
  )

fig
```
Boxplots summarizing partial $\eta^2$ estimates obtained with each method from 300 simulated datasets ($n=20$). The population effect of $X1$ is non-null ($a_1 = 1$), and responses again follow **log-normal distributions**. Hover over the plots to compare the methods.
:::

**Systematic comparison to ground truth estimates**. We conduct an additional experiment to compare the methods to the ground truth across a wider range of effect magnitudes for the normal, log-normal, and ordinal distributions (the latter with five levels and flexible thresholds). For ordinal data, the ground truth is defined as ANOVA applied to the latent variable (i.e., the data prior to discretization). We now use Cohen’s $f$ as a measure of effect size, which is expected to be proportional to the true effect magnitude. Without loss of generality, we focus on the main effect of $X_1$ and fix the sample size to $n=20$.

@fig-effect-main-scatterplots-1 illustrates the relationship between the Cohen's $f$ estimated by each method and the corresponding ground-truth estimate, as $a_1$ and $a_2$ vary independently within the range $[-2, 2]$. This produces Cohen’s $f$ values between $0$ and $1$ for the $4 \times 3$ within-subject and $2 \times 3$ between-subject designs, and a wider range for the $2 \times 4$ mixed design. Proximity to the black diagonal indicates closer agreement with the ground truth. Points above the diagonal indicate overestimation of the effect size, whereas points below indicate underestimation.

::: {#fig-effect-main-scatterplots-1}
```{r, echo=FALSE, fig.height=3.4, message=FALSE, warning=FALSE}
prefix <- "cohens_f_2"
df <- readly_datapoints(prefix,  distributions=c("norm", "lnorm", "likert"), dnames = c("Normal", "Log-normal", "Ordinal (5 levels)"))
fig <- plotly_scatter(df, xlab = "Ground truth", ylab= "Cohen's f", xvar = "grtX1", max = 1.1)

fig
```
Scatterplots showing the relationship between effect size estimates (Cohen's $f$) obtained with each method and those from the ground-truth analysis for the main effect of $X_1$, when $a_1$ and $a_2$ vary independently within the range $[-2, 2]$. 
:::

Under log-normal distributions, PAR tends to severely underestimate effect sizes, whereas ART produces estimates that are widely dispersed on both sides of the ground-truth values. INT yields the most precise estimates, followed by RNK. However, neither method provides accurate estimates for ordinal data. This limitation largely reflects the restricted resolution of the ordinal scale itself: with only five discrete levels, it cannot adequately represent the full range of variation in the latent variable, leading all methods to underestimate effect sizes. The flexible nature of the thresholds in the distributions we tested makes effect size estimation even more challenging. 

@fig-effect-main-scatterplots-2 presents the same relationship for a larger range of effects, with $a_1$ and $a_2$ varying within $[-8, 8]$. 

::: {#fig-effect-main-scatterplots-2}
```{r, echo=FALSE, fig.height=3.4, message=FALSE, warning=FALSE}
prefix <- "cohens_f_8"

df <- readly_datapoints(prefix,  distributions=c("norm", "lnorm", "likert"), dnames = c("Normal", "Log-normal", "Ordinal (5 levels)"))
fig <- plotly_scatter(df, xlab = "Ground truth", ylab= "Cohen's f", xvar = "grtX1", max = 4.2)

fig
```
Scatterplots showing the relationship between effect size estimates (Cohen's $f$) obtained with each method and those from the ground-truth analysis for the main effect of $X_1$, when $a_1$ and $a_2$ vary independently within the range $[-8, 8]$. 
:::

In this broader range, all three rank-based methods --- although RNK to a lesser extent --- struggle to recover large effects, even when the underlying distribution is normal. However, we acknowledge that accurately estimating effects of such magnitudes (e.g., when Cohen's $f > 2$ or partial $\eta^2 > 0.8$) is of limited practical importance.

ART fails entirely under log-normal data, regardless of effect magnitude. Finally, all methods produce highly variable effect size estimates for ordinal data.

**Interactions**. Finally, we present additional results illustrating how rank-based methods can fail to accurately estimate interaction effects. @fig-eta-squared-interaction shows partial $\eta^2$ estimates for the interaction term under normal distributions, as both $a_1$ and $a_2$ increase. Once again, RNK substantially distorts the estimated interaction effect. Although INT mitigates this distortion, the problem reemerges as the main effects become larger.  

::: {#fig-eta-squared-interaction}
```{r, echo=FALSE, warning=FALSE, fig.height=3.5, fig.width=8}
data <- read.csv("results/eta_squared.csv", sep=",", header=TRUE, strip.white=TRUE)
df <- data[data$family == "norm" & data$effectX1 == data$effectX2, ]
df$effectX2 <- factor(df$effectX2)

ylab = "interaction - partial eta squared"
xlab = "magnitude of main effects: a1 and a2"

margins <- list(l = 50, r = 0, b = 60, t = 0, pad = 0)
cbPalette = c("#8888ff", "#888888", "#E69F00", "#009E73", "#FF5E00")
cbPalette2 = c("#8888ff88", "#88888888", "#E69F0088", "#009E7388", "#FF5E0088")

fig1 <- plot_ly(df, x = ~effectX2, y = ~grtX1X2, type = 'box', boxpoints = 'all', name = 'ground truth', hovertemplate = " ", marker = list(color = cbPalette2[1]), fillcolor = cbPalette2[1], line = list(color = cbPalette[1]))  %>% layout(xaxis = list(title = NA))
fig.par <- plot_ly(df, x = ~effectX2, y = ~parX1X2, type = 'box', boxpoints = 'all', name = 'PAR', hovertemplate = " ", marker = list(color = cbPalette2[2]), fillcolor = cbPalette2[2], line = list(color = cbPalette[2])) %>% layout(xaxis = list(title = NA))
fig.rnk <- plot_ly(df, x = ~effectX2, y = ~rnkX1X2, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'RNK', marker = list(color = cbPalette2[3]), fillcolor = cbPalette2[3], line = list(color = cbPalette[3])) %>% layout(xaxis = list(title = NA))
fig.int <- plot_ly(df, x = ~effectX2, y = ~intX1X2, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'INT', marker = list(color = cbPalette2[4]), fillcolor = cbPalette2[4], line = list(color = cbPalette[4])) %>% layout(xaxis = list(title = NA))
fig.art <- plot_ly(df, x = ~effectX2, y = ~artX1X2, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'ART', marker = list(color = cbPalette2[5]), fillcolor = cbPalette2[5], line = list(color = cbPalette[5])) %>% layout(xaxis = list(title = NA))

fig <- subplot(fig.par, fig.rnk, fig.int, fig.art, shareX = TRUE, shareY = T) %>% 
  layout(annotations = list(x = 0.5, y = -0.25, yshift = 0, xref = "paper", yref = "paper", xanchor = "center", yanchor = "bottom", showarrow = F, text = xlab), margin = margins) %>%
	config(displayModeBar = TRUE, scrollZoom = TRUE, displaylogo = FALSE, modeBarButtonsToRemove = c("lasso2d", "select2d",  "zoomIn2d", "zoomOut2d", "autoscale")) %>%  layout(legend = list(orientation = 'h', yanchor="bottom", xanchor="center", y = 1.2, x = .5, colors = cbPalette), yaxis = list(title = ylab), xaxis = list(fixedrange=T)) %>% layout(
    hovermode = "x unified",  # Shared hover on the x-axis
    yaxis = list(spikemode = "across", spikesnap = "cursor")
  )
         
fig
```
Boxplots summarizing partial $\eta^2$ estimates for interaction effects from 300 simulated datasets ($n=20$). The population interaction effect is null, and responses follow **normal distributions**. Hover over the plots to compare the methods.
:::

@fig-eta-squared-ordinal presents results for an ordinal scale with five flexible levels. In this case, effect size estimates become even more distorted across all methods.

::: {#fig-eta-squared-ordinal}
```{r, echo=FALSE, warning=FALSE, fig.height=3.5, fig.width=8}
df <- data[data$family == "likert" & data$effectX1 == data$effectX2, ]
df$effectX2 <- factor(df$effectX2)

ylab = "interaction - partial eta squared"
xlab = "magnitude of main effects: a1 and a2"

margins <- list(l = 50, r = 0, b = 60, t = 0, pad = 0)
cbPalette = c("#8888ff", "#888888", "#E69F00", "#009E73", "#FF5E00")
cbPalette2 = c("#8888ff88", "#88888888", "#E69F0088", "#009E7388", "#FF5E0088")

fig1 <- plot_ly(df, x = ~effectX2, y = ~grtX1X2, type = 'box', boxpoints = 'all', name = 'ground truth', hovertemplate = " ", marker = list(color = cbPalette2[1]), fillcolor = cbPalette2[1], line = list(color = cbPalette[1]))  %>% layout(xaxis = list(title = NA))
fig.par <- plot_ly(df, x = ~effectX2, y = ~parX1X2, type = 'box', boxpoints = 'all', name = 'PAR', hovertemplate = " ", marker = list(color = cbPalette2[2]), fillcolor = cbPalette2[2], line = list(color = cbPalette[2])) %>% layout(xaxis = list(title = NA))
fig.rnk <- plot_ly(df, x = ~effectX2, y = ~rnkX1X2, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'RNK', marker = list(color = cbPalette2[3]), fillcolor = cbPalette2[3], line = list(color = cbPalette[3])) %>% layout(xaxis = list(title = NA))
fig.int <- plot_ly(df, x = ~effectX2, y = ~intX1X2, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'INT', marker = list(color = cbPalette2[4]), fillcolor = cbPalette2[4], line = list(color = cbPalette[4])) %>% layout(xaxis = list(title = NA))
fig.art <- plot_ly(df, x = ~effectX2, y = ~artX1X2, type = 'box', boxpoints = 'all', hovertemplate = " ", name = 'ART', marker = list(color = cbPalette2[5]), fillcolor = cbPalette2[5], line = list(color = cbPalette[5])) %>% layout(xaxis = list(title = NA))

fig <- subplot(fig1, fig.par, fig.rnk, fig.int, fig.art, shareX = TRUE, shareY = T) %>% 
  layout(annotations = list(x = 0.5, y = -0.25, yshift = 0, xref = "paper", yref = "paper", xanchor = "center", yanchor = "bottom", showarrow = F, text = xlab), margin = margins) %>%
	config(displayModeBar = TRUE, scrollZoom = TRUE, displaylogo = FALSE, modeBarButtonsToRemove = c("lasso2d", "select2d",  "zoomIn2d", "zoomOut2d", "autoscale")) %>%  layout(legend = list(orientation = 'h', yanchor="bottom", xanchor="center", y = 1.2, x = .5, colors = cbPalette), yaxis = list(title = ylab), xaxis = list(fixedrange=T)) %>% layout(
    hovermode = "x unified",  # Shared hover on the x-axis
    yaxis = list(spikemode = "across", spikesnap = "cursor")
  )
         
fig
```
Boxplots summarizing partial $\eta^2$ estimates for interaction effects from 300 simulated datasets ($n=20$). The population interaction effect is null, and responses are **ordinal with 5 flexible levels**. Hover over the plots to compare the methods.
:::
