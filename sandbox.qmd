---
title: "The illusory promise of the Aligned Rank Transform"
subtitle: "A systematic study of rank transformations"
author: 
  - name: Theophanis Tsandilas
    orcid: 0000-0002-0158-228X
    email: theophanis.tsandilas@inria.fr
    affiliations:
      - name: Université Paris-Saclay, CNRS, Inria, LISN
        country: France
  - name: Géry Casiez
    orcid: 0000-0003-1905-815X
    email: gery.casiezuniv-lille.fr
    affiliations:
      - name: Univ. Lille, CNRS, Inria, Centrale Lille, UMR 9189 CRIStAL
        country: France
bibliography: bibliography.bib
csl: canadian-journal-of-philosophy.csl

tbl-cap-location: top
---

::: {.callout-important appearance="simple"}
## Under Review {.unnumbered}
This paper is [under review](https://www.journalovi.org/under-review.html) on the experimental track of
the [Journal of Visualization and Interaction](https://www.journalovi.org/). See the 
[reviewing process](https://github.com/journalovi/2024-tsandilas-ranktransforms/issues).
:::

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Useful libraries
library(crosstalk)
library(kableExtra)
library(gridExtra)
library(lmerTest)
library(tidyverse)
library(plotly)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Source code for reading data from experimental results and for plotting
source("dataReaders.R")
source("plotting.R")
source("plotlying.R")
source("effects_plot.R")
source("interactions_plot.R")
```

```{=html}
<style>
.math.inline .MathJax  {
  font-size: 105% !important;
}
</style>
```


::: {#fig-art-binary}
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=3.2, fig.width=8}
library(gridExtra)

df <- read.csv("data-binary.csv", sep=",", header=TRUE, strip.white=TRUE)
df$S <- factor(df$S)
df$A <- factor(df$A)
df$B <- factor(df$B)

df$rnk <- rank(df$Y)

m <- mean(df$Y)
Ai <- aggregate(Y ~ A, data = df, mean)
Bj <- aggregate(Y ~ B, data = df, mean) 
AiBj <- aggregate(Y ~ A+B, data = df, mean) 
cmean <- aggregate(Y ~ A+B, data = df, mean) 

library(dplyr)
df <- df %>% group_by(A) %>% mutate(Ai = mean(Y)) %>% 
  group_by(B) %>% mutate(Bj = mean(Y)) %>% 
  group_by(A,B) %>% mutate(AiBj = mean(Y)) %>% mutate(Cell = mean(Y))

df$m <- mean(df$Y)

df$artA <- df$Y - df$Cell + df$Ai - df$m
df$artB <- df$Y - df$Cell + df$Bj - df$m
df$artAB <- df$Y - df$Cell + df$AiBj - df$Ai - df$Bj + df$m 

df$rnkA <- rank(round(df$artA, digits = 7))
df$rnkB <- rank(round(df$artB, digits = 7))
df$rnkAB <- rank(round(df$artAB, digits = 7))

mytheme <- gridExtra::ttheme_default(
    core = list(fg_params=list(cex = 2.0)),
    colhead = list(fg_params=list(cex = 1.0)),
    rowhead = list(fg_params=list(cex = 1.0)))

myTable <- tableGrob(df[,1:4], theme = ttheme_minimal(base_size = 10) ) 

diffPalette = c("#E69F00", "#FF5E00")
p1 <- (df %>%   
        ggplot(aes(x = B, y = rnk, fill = B)) + ggtitle("RNK") +
        geom_boxplot(outlier.shape = NA) +
        geom_jitter(position=position_jitter(0.3,0), size = 2, color=diffPalette[1], alpha=0.6) +
        theme_bw() + theme(legend.position = "none", plot.title = element_text(hjust = 0.5))) +  
        ylab("ranking") + scale_y_discrete(limits=as.character(1:nrow(df)))

p2 <- (df %>%   
        ggplot(aes(x = B, y = rnkB, fill = B)) + ggtitle("ART_B") +
        geom_boxplot(outlier.shape = NA) + 
        geom_jitter(position=position_jitter(0.3,0), size = 2, color=diffPalette[2], alpha=0.6) +
        theme_bw() + theme(legend.position = "none", plot.title = element_text(hjust = 0.5))) +  
        theme(axis.title.y=element_blank(), axis.text.y=element_blank()) + scale_y_discrete(limits=as.character(1:nrow(df)))

grid.arrange(myTable, p1, p2, nrow = 1)
```
Results from an experiment following a $3 \times 2$ design, where the response variable $Y$ is binary and indicates the presence of an error. The plots show the rankings produced by the simple rank transformation (RNK) and by ART for the second factor. The solid lines represent group medians.    
:::
