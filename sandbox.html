<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Theophanis Tsandilas">
<meta name="author" content="Géry Casiez">

<title>The illusory promise of the Aligned Rank Transform</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="sandbox_files/libs/clipboard/clipboard.min.js"></script>
<script src="sandbox_files/libs/quarto-html/quarto.js"></script>
<script src="sandbox_files/libs/quarto-html/popper.min.js"></script>
<script src="sandbox_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sandbox_files/libs/quarto-html/anchor.min.js"></script>
<link href="sandbox_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sandbox_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sandbox_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sandbox_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sandbox_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#methodology" id="toc-methodology" class="nav-link active" data-scroll-target="#methodology"><span class="header-section-number">1</span> Experimental method</a>
  <ul class="collapse">
  <li><a href="#statistical-modeling" id="toc-statistical-modeling" class="nav-link" data-scroll-target="#statistical-modeling">Statistical modeling</a></li>
  <li><a href="#effects-and-population-control" id="toc-effects-and-population-control" class="nav-link" data-scroll-target="#effects-and-population-control">Effects and population control</a></li>
  <li><a href="#implementation-of-rank-transformation-methods" id="toc-implementation-of-rank-transformation-methods" class="nav-link" data-scroll-target="#implementation-of-rank-transformation-methods">Implementation of rank transformation methods</a></li>
  <li><a href="#evaluation-measures" id="toc-evaluation-measures" class="nav-link" data-scroll-target="#evaluation-measures">Evaluation measures</a></li>
  <li><a href="#hardware-platform-and-iterations" id="toc-hardware-platform-and-iterations" class="nav-link" data-scroll-target="#hardware-platform-and-iterations">Hardware platform and iterations</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The illusory promise of the Aligned Rank Transform</h1>
<p class="subtitle lead">A systematic study of rank transformations</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Theophanis Tsandilas <a href="https://orcid.org/0000-0002-0158-228X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Université Paris-Saclay, CNRS, Inria, LISN
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    <p class="author">Géry Casiez <a href="https://orcid.org/0000-0003-1905-815X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Univ. Lille, CNRS, Inria, Centrale Lille, UMR 9189 CRIStAL
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<style>
.math.inline .MathJax  {
  font-size: 105% !important;
}
</style>
<section id="methodology" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="methodology"><span class="header-section-number">1</span> Experimental method</h2>
<p>We can now detail our experimental method. We evaluate the standard parametric approach (<em>PAR</em>) and the three rank-transformation methods (<em>RNK</em>, <em>INT</em>, and <em>ART</em>) that we introduced earlier. We conduct a series of Monte Carlo experiments that assess their performance under a variety of experimental configurations:</p>
<p><strong>Distributions.</strong> We evaluate both <em>ratio</em> and <em>ordinal</em> data, drawn from the following distributions:</p>
<ol type="1">
<li><em>Normal distribution</em> <span class="math inline">\(\mathcal{N}(\mu, \sigma^2)\)</span>, where <span class="math inline">\(\mu\)</span> is its mean and <span class="math inline">\(\sigma^2\)</span> is its standard deviation. For most experiments where variances are equal, we set <span class="math inline">\(\sigma^2 = 1\)</span>.</li>
<li><em>Log-normal distribution</em> <span class="math inline">\(\mathcal{LogN}(\mu, \sigma^2)\)</span>, where <span class="math inline">\(\mu\)</span> is its mean and <span class="math inline">\(\sigma^2\)</span> is its standard deviation at the logarithmic scale. The log-normal distribution is a good model for various measures bounded by zero, such as task-completion times. We set <span class="math inline">\(\sigma = 1\)</span> in our main experiments but evaluate a wider range of parameters in <a href="appendix_I.html#lognormal">Appendix I</a>.</li>
<li><em>Exponential distribution</em> <span class="math inline">\(Exp(\lambda)\)</span>, where <span class="math inline">\(\lambda\)</span> is its rate. The exponential distribution naturally emerges when describing the time elapsed between events. For example, we could use it to model the time a random person spends with a public display, or the waiting time before a new person approaches to interact with the display, when the average waiting time is <span class="math inline">\(\frac{1}{\lambda}\)</span>.<br>
</li>
<li><em>Cauchy distribution</em> <span class="math inline">\(\mathcal{Cauchy}(x_0, \gamma)\)</span>, where <span class="math inline">\(x_0\)</span> defines its location (median) and <span class="math inline">\(\gamma\)</span> defines its scale. The Cauchy distribution is the distribution of the ratio of two independent normally distributed random variables. It rarely emerges in practice. However, it is commonly used in statistics to test the robustness of statistical procedures because both its mean and variance are undefined. As we discussed earlier, past evaluations of ART <span class="citation" data-cites="Mansouri:1995 elkin:2021">(<a href="#ref-Mansouri:1995" role="doc-biblioref">Mansouri and Chang 1995</a>; <a href="#ref-elkin:2021" role="doc-biblioref">Elkin et al. 2021</a>)</span> show that the method fails under the Cauchy distribution. We set <span class="math inline">\(\gamma = 1\)</span>.</li>
<li><em>Poisson distribution</em> <span class="math inline">\(\mathcal{Pois}(\lambda)\)</span>, where <span class="math inline">\(\lambda\)</span> is its rate. It expresses the probability of a given number of events in a fixed interval of time. For example, we could use it to model the number of people who interact with a public display in an hour, when the average rate is <span class="math inline">\(\lambda\)</span> people per hour.</li>
<li><em>Binomial distribution</em> <span class="math inline">\(\mathcal{B}(\kappa, p)\)</span>, where <span class="math inline">\(\kappa\)</span> defines the number of independent Bernoulli trials and <span class="math inline">\(p\)</span> is the probability of error or success of each trial. It frequently appears in HCI research, as it can model the number of successes and failures in a series of experimental tasks. We set <span class="math inline">\(\kappa = 10\)</span> in our main experiments but evaluate a wider range of parameters in <a href="appendix_I.html#binomial">Appendix I</a>.</li>
<li>Distributions of <em>Likert-item</em> responses with 5, 7, and 11 discrete levels.</li>
</ol>
<p><strong>Experimental designs.</strong> We present results for five experimental designs. To simplify our presentation, we start with (i) a 4 <span class="math inline">\(\times\)</span> 3 within-subjects factorial design. We then show how our conclusions generalize to four additional designs: (ii) a 2 <span class="math inline">\(\times\)</span> 3 between-subjects design; (iii) a 2 <span class="math inline">\(\times\)</span> 4 mixed design, with a between-subjects factor and a within-subjects factor; (iv) a 2 <span class="math inline">\(\times\)</span> 2 <span class="math inline">\(\times\)</span> 2 within-subjects design; and (v) a 3 <span class="math inline">\(\times\)</span> 3 <span class="math inline">\(\times\)</span> 3 within-subjects design.</p>
<p><strong>Sample sizes.</strong> We focus on three sample sizes, <span class="math inline">\(n=10\)</span>, <span class="math inline">\(n=20\)</span>, and <span class="math inline">\(n=30\)</span>, where <span class="math inline">\(n\)</span> represents the cell size in an experimental design. However, for certain scenarios, we also report results for larger sample sizes, up to <span class="math inline">\(n = 512\)</span>. In within-subjects designs, where all factors are treated as repeated measures, <span class="math inline">\(n\)</span> corresponds to the number of subjects <span class="math inline">\(N\)</span> (commonly human participants in HCI research). In contrast, in a 2 <span class="math inline">\(\times\)</span> 3 between-subjects design, a cell size of <span class="math inline">\(n = 20\)</span>, implies a total of <span class="math inline">\(N = 120\)</span> subjects.</p>
<p><strong>Equal vs.&nbsp;unequal variances.</strong> For normal and ordinal distributions, we test the robustness of the methods when variances are unequal.</p>
<p><strong>Evaluation measures.</strong> In addition to Type I error rates, we compare the statistical power of the methods and compare their effect size estimates with ground-truth estimates.</p>
<p><strong>Magnitude of effects.</strong> We analyze both main and interaction effects, examining how increasing the magnitude of effect of one factor influences the Type I error rates of other factors and their interactions. In addition, we examine how increasing two main effects in parallel influences the Type I error rate of their interaction, while emphasizing that the definition of the null hypothesis in this case is ambiguous.</p>
<!--
Furthermore, we assess how a growing interaction effect, either in isolation or in combination with a main effect, can affect the inference of main effects. -->
<p>Previous evaluations of rank transformation methods <span class="citation" data-cites="Beasley:2009 luepsen:2018">(<a href="#ref-Beasley:2009" role="doc-biblioref">Beasley, Erickson, and Allison 2009</a>; <a href="#ref-luepsen:2018" role="doc-biblioref">Lüpsen 2018</a>)</span> have also examined unbalanced designs, where cell sizes vary across the levels of a factor. When combined with unequal variances, such designs often pose challenges for both parametric procedures <span class="citation" data-cites="blanca:2018">(<a href="#ref-blanca:2018" role="doc-biblioref">Blanca et al. 2018</a>)</span> and rank transformation methods <span class="citation" data-cites="Beasley:2009 luepsen:2018">(<a href="#ref-Beasley:2009" role="doc-biblioref">Beasley, Erickson, and Allison 2009</a>; <a href="#ref-luepsen:2018" role="doc-biblioref">Lüpsen 2018</a>)</span>. As noted earlier, we do not consider unbalanced designs in our main article. However, we provide additional experimental results on missing data in <a href="appendix_I.html#missing">Appendix I</a>.</p>
<section id="statistical-modeling" class="level3">
<h3 class="anchored" data-anchor-id="statistical-modeling">Statistical modeling</h3>
<p>For simplicity, we explain here our modeling approach for two factors, but its extension to three factors is straightforward.</p>
<p><strong>Linear component.</strong> The base of our data generation process for all distributions is the following linear term:</p>
<p><span id="eq-linear-model"><span class="math display">\[
\ell_{ijk} = \mu + s_k + a_1 x_{1i} + a_2 x_{2j} + a_{12} x_{1i} x_{2j}
\tag{1}\]</span></span></p>
<ul>
<li><p><span class="math inline">\(\mu\)</span> is the grand mean</p></li>
<li><p><span class="math inline">\(s_k \sim \mathcal{N}(0, \sigma_s^2)\)</span> is the random intercept effect of the <em>k</em>-th subject, where <span class="math inline">\(k = 1..n\)</span></p></li>
<li><p><span class="math inline">\(x_{1i}\)</span> is a numerical encoding of the <em>i</em>-th level of factor <span class="math inline">\(X_1\)</span>, where <span class="math inline">\(i = 1..m_1\)</span></p></li>
<li><p><span class="math inline">\(x_{2j}\)</span> is a numerical encoding of the <em>j</em>-th level of factor <span class="math inline">\(X_2\)</span>, where <span class="math inline">\(j = 1..m_2\)</span></p></li>
<li><p><span class="math inline">\(a_1\)</span>, <span class="math inline">\(a_2\)</span>, and <span class="math inline">\(a_{12}\)</span> express the magnitude of main and interaction effects</p></li>
</ul>
<!--
 - $\varepsilon_{ijk}$ is the experimental error effect
 -->
<p>While random slope effects can have an impact on real experimental data <span class="citation" data-cites="barr:2013">(<a href="#ref-barr:2013" role="doc-biblioref">Barr et al. 2013</a>)</span>, we do not consider them here for two main reasons: (1) to be consistent with previous evaluations of the ART procedure <span class="citation" data-cites="elkin:2021">(<a href="#ref-elkin:2021" role="doc-biblioref">Elkin et al. 2021</a>)</span>; and (2) because mixed-effects procedures with random slope effects are computationally demanding, adding strain to simulation resources. However, there is no good reason to believe that adding random slope effects would impact our findings and conclusions.</p>
<p><strong>Encoding the levels of factors.</strong> To encode the levels of the two factors <span class="math inline">\(x_{1i} \in X_1\)</span> and <span class="math inline">\(x_{2j} \in X_2\)</span> we proceed as follows:</p>
<ol type="1">
<li><p>We normalize the distance between their first and their second levels such that <span class="math inline">\(x_{12} - x_{11} = 1\)</span> and <span class="math inline">\(x_{22} - x_{21} = 1\)</span>. This approach enables us to conveniently control for the main and interaction effects by simply varying the parameters <span class="math inline">\(a_1\)</span>, <span class="math inline">\(a_2\)</span>, and <span class="math inline">\(a_{12}\)</span>.</p></li>
<li><p>For the remaining levels, we randomly sample from a uniform distribution that spans the range between these two extreme levels, i.e., between <span class="math inline">\(x_{11}\)</span> and <span class="math inline">\(x_{12}\)</span> for <span class="math inline">\(X_1\)</span>, and between <span class="math inline">\(x_{21}\)</span> and <span class="math inline">\(x_{22}\)</span> for <span class="math inline">\(X_2\)</span>. This approach allows us to generate and evaluate a substantial variety of configurations, each representing different relative effects between levels.</p></li>
<li><p>We require all levels to sum up to 0, or <span class="math inline">\(\sum\limits_{i=1}^{m_1} x_{1i} = 0\)</span> and <span class="math inline">\(\sum\limits_{j=1}^{m_2} x_{2j} = 0\)</span>, which ensures that the grand mean is <span class="math inline">\(\mu\)</span>.</p></li>
</ol>
<p>For example, we can encode a factor with four levels as <span class="math inline">\(\{-.6, .4, .1, .1\}\)</span> or as <span class="math inline">\(\{-.5, .5, .3, -.3\}\)</span>.</p>
<p><strong>Generating ratio data.</strong> We adopt generalized linear modeling <span class="citation" data-cites="Bolker2009glm">(<a href="#ref-Bolker2009glm" role="doc-biblioref">Bolker et al. 2009</a>)</span> for ratio data, where we use an inverse link function <span class="math inline">\(g^{-1}\)</span> to make the connection between <span class="math inline">\(\ell_{ijk}\)</span> and the location parameter of the distribution of interest:<br>
<span id="eq-glm-ratio"><span class="math display">\[
Y_{ijk} \sim \mathcal{F}(location=g^{-1}(\ell_{ijk}), ...)
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(\mathcal{F}\)</span> denotes the probability density (or mass) function from which we draw the responses <span class="math inline">\(Y_{ijk}\)</span>. For example, the mean of the exponential distribution is equal to <span class="math inline">\(1 / \lambda\)</span>, where <span class="math inline">\(\lambda\)</span> is its rate parameter. This mean is linked to the linear term through the function <span class="math inline">\(g^{-1}(x) = e^{x}\)</span>, and therefore, <span class="math inline">\(\lambda = e^{-\ell_{ijk}}\)</span>. Or the link function commonly used for the binomial distribution is the <em>logit</em> function, but its inverse if the <em>logistic</em> function <span class="math inline">\(g^{-1}(x) = 1 / (1 + e^{-x})\)</span>.</p>
<p><a href="#tbl-distributions">Table&nbsp;1</a> presents how the location parameters of the other distributions are linked to the linear term. We emphasize that the Cauchy distribution does not define a GLM (since it does not belong to the exponential family), but we use a model that connects its location (median) through the identity link.</p>
<div id="tbl-distributions" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Distribution parameters and their links to the linear term <span class="math inline">\(\ell_{ijk}\)</span></caption>
<colgroup>
<col style="width: 26%">
<col style="width: 22%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>distribution</th>
<th>location parameter</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td><span class="math inline">\(\mu = \ell_{ijk}\)</span></td>
<td>mean</td>
</tr>
<tr class="even">
<td>Log-normal</td>
<td><span class="math inline">\(\mu = \ell_{ijk}\)</span></td>
<td>mean at logarithmic scale (logarithm of median)</td>
</tr>
<tr class="odd">
<td>Exponential</td>
<td><span class="math inline">\(\lambda = e^{-\ell_{ijk}}\)</span></td>
<td>rate (1 / mean)</td>
</tr>
<tr class="even">
<td>Cauchy</td>
<td><span class="math inline">\(x_0 = \ell_{ijk}\)</span></td>
<td>median</td>
</tr>
<tr class="odd">
<td>Poisson</td>
<td><span class="math inline">\(\lambda = e^{\ell_{ijk}}\)</span></td>
<td>rate (mean)</td>
</tr>
<tr class="even">
<td>Binomial</td>
<td><span class="math inline">\(p = 1 / (1 + e^{-\ell_{ijk}})\)</span></td>
<td>probability of success or error</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Generating ordinal data.</strong> For generating ordinal data, we follow a latent-variable approach as explained by <span class="citation" data-cites="Liddell:2018">Liddell and Kruschke (<a href="#ref-Liddell:2018" role="doc-biblioref">2018</a>)</span>. Specifically, we consider that there is a continuous latent variable that follows a normal distribution: <span id="eq-ordinal-latent"><span class="math display">\[
Y_{ijk}^* \sim \mathcal{N}(\mu = \ell_{ijk}, \sigma^2 = 1)
\tag{3}\]</span></span> From this, we derive discrete responses <span class="math inline">\(d = 1,2 ... D\)</span> by applying fixed thresholds <span class="math inline">\(\tau_d \in (-\infty, \infty)\)</span> as follows: <span id="eq-ordinal-thresholds"><span class="math display">\[
\begin{aligned}
Y_{ijk} = d\ \ \text{if}\ \ \tau_{d-1} &lt; Y_{ijk}^* \leq \tau_d
\end{aligned}
\tag{4}\]</span></span> Since, in practice, <span class="math inline">\(\tau_0 = -\infty\)</span> and <span class="math inline">\(\tau_D = \infty\)</span>, generating responses with <span class="math inline">\(D\)</span> discrete levels requires <span class="math inline">\(D-1\)</span> thresholds.</p>
</section>
<section id="effects-and-population-control" class="level3">
<h3 class="anchored" data-anchor-id="effects-and-population-control">Effects and population control</h3>
<p>We next detail how we select the parameters of the linear component (see <a href="#eq-linear-model">Equation&nbsp;1</a>) for the various distributions, as well as the thresholds of the ordinal model (see <a href="#eq-ordinal-thresholds">Equation&nbsp;4</a>).</p>
<p><strong>Magnitude of effects.</strong> We control the magnitude of effects by varying <span class="math inline">\(a_1\)</span>, <span class="math inline">\(a_2\)</span>, and, for some experiments (those evaluating power for interactions), <span class="math inline">\(a_{12}\)</span>. <a href="#fig-effects-normal">Figure&nbsp;1</a> presents normal distributions (<span class="math inline">\(\sigma^2 = 1\)</span>) generated across the range of values of <span class="math inline">\(a_1\)</span> used to evaluate Type I error rates. In these examples, we illustrate effects for a factor with three categorical levels and, for clarity, disregard between-subject variability (<span class="math inline">\(\sigma_k^2 = 0\)</span>).</p>
<div id="fig-effects-normal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="cell">
<div class="cell-output-display">
<p><img src="sandbox_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="864"></p>
</div>
</div>
<figcaption class="figure-caption">Figure&nbsp;1: Varying <span class="math inline">\(a_1\)</span> to control the magnitude of the main effect of <span class="math inline">\(X_1\)</span>. The plots show examples of normal distributions (<span class="math inline">\(\sigma^2=1\)</span>) for a factor with three categorical levels.</figcaption>
</figure>
</div>
<p><strong>Grand mean and variance parameters.</strong> We select the mean term <span class="math inline">\(\mu\)</span> to match a target location of the responses. <a href="#tbl-locations">Table&nbsp;2</a> reports the target location for each distribution, which is typically the overall mean (or the median in the case of the Cauchy distribution). We describe how <span class="math inline">\(\mu\)</span> is derived from these parameters in <a href="appendix_II.html#mu">Appendix II</a>.</p>
<div id="tbl-locations" class="anchored">
<table class="table">
<caption>Table&nbsp;2: Target mean (median for the Cauchy distribution) of responses <span class="math inline">\(Y_{ijk}\)</span></caption>
<colgroup>
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Normal</th>
<th style="text-align: center;">Log-normal</th>
<th style="text-align: center;">Exponential</th>
<th style="text-align: center;">Cauchy</th>
<th style="text-align: center;">Poisson</th>
<th style="text-align: center;">Binomial</th>
<th style="text-align: center;">Ordinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.1 (per trial)</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
<p><a href="#fig-effects-distributions">Figure&nbsp;2</a> shows distributions generated with these location values when <span class="math inline">\(a_1 = 2\)</span> for a factor with three categorical levels.</p>
<div id="fig-effects-distributions" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="cell">
<div class="cell-output-display">
<p><img src="sandbox_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="864"></p>
</div>
</div>
<figcaption class="figure-caption">Figure&nbsp;2: Different ratio distributions generated with <span class="math inline">\(a_1 = 2\)</span> when <span class="math inline">\(X_1\)</span> has three categorical levels (here, <span class="math inline">\(\sigma_k^2 = 0\)</span>).</figcaption>
</figure>
</div>
<p>In practice, we randomly choose the standard deviation <span class="math inline">\(\sigma_k^2\)</span> — which determines between-subject variability — from the interval <span class="math inline">\([0.1, 0.5]\)</span>, drawing each value from a uniform distribution.</p>
<p><strong>Thresholds of ordinal scales.</strong> For ordinal data, we evaluate <span class="math inline">\(D =\)</span> 5, 7, or 11 discrete levels. To derive the discretization thresholds <span class="math inline">\(\tau_d\)</span>, we first consider the range <span class="math inline">\([-2SD, 2SD]\)</span> , where <span class="math inline">\(SD\)</span> is the overall standard deviation of the latent variable <span class="math inline">\(Y^{*}_{ijk}\)</span>. We then divide this range into 5, 7, or 11 intervals, following two different strategies: (i) setting thresholds to be <em>equidistant</em>; or (ii) considering <em>flexible</em> thresholds, randomly drawing their position in the above range.</p>
<p><a href="#fig-ordinal">Figure&nbsp;3</a> presents examples of equidistant and flexible thresholds for a 5-level scale when the magnitude of main effect of <span class="math inline">\(X_1\)</span> is either <span class="math inline">\(a_1 = 2\)</span> or <span class="math inline">\(a_1 = 8\)</span>, while all other effects are zero.</p>
<div id="fig-ordinal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="cell">
<div class="cell-output-display">
<p><img src="sandbox_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="864"></p>
</div>
</div>
<figcaption class="figure-caption">Figure&nbsp;3: The four vertical lines in each plot represent thresholds defining 5-level ordinal scales. Thresholds are either equidistant (top) or flexible (bottom) within a range of <span class="math inline">\(\pm 2\)</span> standard deviations around the grand mean <span class="math inline">\(\mu = 0\)</span>.</figcaption>
</figure>
</div>
</section>
<section id="implementation-of-rank-transformation-methods" class="level3">
<h3 class="anchored" data-anchor-id="implementation-of-rank-transformation-methods">Implementation of rank transformation methods</h3>
<p>For the aligned rank transformation (ART), we use the R implementation of ARTool v0.11.1 <span class="citation" data-cites="artool">(<a href="#ref-artool" role="doc-biblioref">Kay et al. 2021</a>)</span>. For the pure rank transformation (RNK), we use R’s <em>rank()</em> function. We use the <em>Rankit</em> formulation <span class="citation" data-cites="Bliss:1956">(<a href="#ref-Bliss:1956" role="doc-biblioref">Bliss, Greenwood, and White 1956</a>)</span> for the inverse normal transformation (INT), as explained earlier.</p>
<p>Unless stated otherwise, we analyze the data using ANOVA with R’s <em>aov()</em> function and the model specification <code>Y' ~ X1 * X2 + Error(S)</code>. For balanced designs, this approach yields results that are identical or nearly identical to those obtained using R’s <em>lmer()</em> function with the model specification <code>Y' ~ X1 * X2 + (1 | S)</code>.</p>
</section>
<section id="evaluation-measures" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-measures">Evaluation measures</h3>
<p>Significance tests have two types of errors. <em>Type I errors</em>, or false positives, are mistaken rejections of the null hypothesis. Type II errors, of false negatives, are failures to reject a null hypothesis that is actually true. In our illustrative example in <strong>?@fig-example</strong>, a Type I error is finding that there is an effect of the choice of the technique on time performance. A <em>Type II error</em>, in turn, is finding that the task difficulty has no effect on time performance.</p>
<p>Statistical significance testing requires setting a significance threshold known as significance or <span class="math inline">\(\alpha\)</span> (alpha) level, with typical values <span class="math inline">\(\alpha = .05\)</span> and <span class="math inline">\(\alpha = .01\)</span>. The Type I error rate of a well-behaved significance test should be close to this nominal alpha level. An error rate clearly above this level suggests that the significance test is too liberal, while an error rate clearly below this level suggests that the test is too conservative. Four of our experiments specifically assess the Type I error rate of the methods. We test two significance levels: <span class="math inline">\(\alpha = .05\)</span> and <span class="math inline">\(\alpha = .01\)</span>. For brevity, we only report results for <span class="math inline">\(\alpha = .05\)</span> in the main paper and include additional results in our supplementary material.</p>
<p>We do not directly evaluate Type II errors. Instead, we report on statistical <em>power</em> defined as <span class="math inline">\(Power = 1 - \beta\)</span>, where <span class="math inline">\(\beta\)</span> is the rate of Type II errors. Significance tests do not provide any power guarantees. However, we can compare the power of different methods to evaluate their relative performance. In addition to power, we assess effect size estimates, where we use as ground truth the estimates of a parametric ANOVA conducted on the latent variable <span class="math inline">\(\mathcal{Y}\)</span>. While partial <span class="math inline">\(\eta^2\)</span> is the most commonly used effect size measure, we also evaluate Cohen’s <span class="math inline">\(f\)</span>, as its expected value is proportional to the real magnitude of effect. However, <span class="math inline">\(\eta^2\)</span> can be directly derived from Cohen’s <span class="math inline">\(f\)</span> as follows:</p>
<p><span id="eq-cohensf"><span class="math display">\[
\eta^2 = \frac{f^2}{1 + f^2}
\tag{5}\]</span></span></p>
<p>As explained earlier, interaction effects are distorted when the latent variable <span class="math inline">\(\mathcal{Y}\)</span> is transformed to produce the observed responses. These transformations also influence the Type I error rates and statistical power we observe. In this analysis, we focus on evaluating these measures with respect to the effects applied to the latent variable <span class="math inline">\(\mathcal{Y}\)</span>. We explicitly make this distinction whenever it is relevant to our discussion.</p>
</section>
<section id="hardware-platform-and-iterations" class="level3">
<h3 class="anchored" data-anchor-id="hardware-platform-and-iterations">Hardware platform and iterations</h3>
<p>Our experimental R code is available in our supplementary material. We ran our experiments separately in a cluster of 8 machines Dell R640 Intel Xeon Silver 4112 2.6GHz with 4 cores and 64 GB memory. Our R code was parallelized to use all four cores of each machine. Some experiments took a few hours to complete, while others took several days.</p>
<p>To estimate the power and Type I error rates of the four methods with enough precision, we ran <span class="math inline">\(5000\)</span> iterations for each population configuration and each sample size.</p>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-barr:2013" class="csl-entry" role="listitem">
Barr, Dale J, Roger Levy, Christoph Scheepers, and Harry J Tily. 2013. <span>“Random Effects Structure for Confirmatory Hypothesis Testing: Keep It Maximal.”</span> <em>J Mem Lang</em> 68 (3). <a href="https://doi.org/10.1016/j.jml.2012.11.001">https://doi.org/10.1016/j.jml.2012.11.001</a>.
</div>
<div id="ref-Beasley:2009" class="csl-entry" role="listitem">
Beasley, T Mark, Stephen Erickson, and David B Allison. 2009. <span>“Rank-Based Inverse Normal Transformations Are Increasingly Used, but Are They Merited?”</span> <em>Behav Genet</em> 39 (5): 580–595. <a href="https://doi.org/10.1007/s10519-009-9281-0">https://doi.org/10.1007/s10519-009-9281-0</a>.
</div>
<div id="ref-blanca:2018" class="csl-entry" role="listitem">
Blanca, Marı́a J., Rafael Alarcón, Jaume Arnau, Roser Bono, and Rebecca Bendayan. 2018. <span>“Effect of Variance Ratio on ANOVA Robustness: Might 1.5 Be the Limit?”</span> <em>Behavior Research Methods</em> 50 (3): 937–962. <a href="https://doi.org/10.3758/s13428-017-0918-2">https://doi.org/10.3758/s13428-017-0918-2</a>.
</div>
<div id="ref-Bliss:1956" class="csl-entry" role="listitem">
Bliss, C. I., Mary L. Greenwood, and Edna Sakamoto White. 1956. <span>“A Rankit Analysis of Paired Comparisons for Measuring the Effect of Sprays on Flavor.”</span> <em>Biometrics</em> 12 (4): 381–403. <a href="http://www.jstor.org/stable/3001679">http://www.jstor.org/stable/3001679</a>.
</div>
<div id="ref-Bolker2009glm" class="csl-entry" role="listitem">
Bolker, Benjamin M., Mollie E. Brooks, Connie J. Clark, Shane W. Geange, John R. Poulsen, M. Henry H. Stevens, and Jada-Simone S. White. 2009. <span>“Generalized Linear Mixed Models: A Practical Guide for Ecology and Evolution.”</span> <em>Trends in Ecology &amp; Evolution</em> 24 (3): 127–135. <a href="https://doi.org/10.1016/j.tree.2008.10.008">https://doi.org/10.1016/j.tree.2008.10.008</a>.
</div>
<div id="ref-elkin:2021" class="csl-entry" role="listitem">
Elkin, Lisa A., Matthew Kay, James J. Higgins, and Jacob O. Wobbrock. 2021. <span>“An Aligned Rank Transform Procedure for Multifactor Contrast Tests.”</span> <em>The 34th Annual ACM Symposium on User Interface Software and Technology</em> (New York, NY, USA), UIST ’21, 2021, 754–768. <a href="https://doi.org/10.1145/3472749.3474784">https://doi.org/10.1145/3472749.3474784</a>.
</div>
<div id="ref-artool" class="csl-entry" role="listitem">
Kay, Matthew, Lisa A. Elkin, James J. Higgins, and Jacob O. Wobbrock. 2021. <em>ARTool r Package</em>. <a href="https://cran.r-project.org/web/packages/ARTool">https://cran.r-project.org/web/packages/ARTool</a>.
</div>
<div id="ref-Liddell:2018" class="csl-entry" role="listitem">
Liddell, Torrin M., and John K. Kruschke. 2018. <span>“Analyzing Ordinal Data with Metric Models: What Could Possibly Go Wrong?”</span> <em>Journal of Experimental Social Psychology</em> 79: 328–348. <a href="https://doi.org/10.1016/j.jesp.2018.08.009">https://doi.org/10.1016/j.jesp.2018.08.009</a>.
</div>
<div id="ref-luepsen:2018" class="csl-entry" role="listitem">
Lüpsen, Haiko. 2018. <span>“Comparison of Nonparametric Analysis of Variance Methods: A Vote for van Der Waerden.”</span> <em>Communications in Statistics - Simulation and Computation</em> 47 (9): 2547–2576. <a href="https://doi.org/10.1080/03610918.2017.1353613">https://doi.org/10.1080/03610918.2017.1353613</a>.
</div>
<div id="ref-Mansouri:1995" class="csl-entry" role="listitem">
Mansouri, H., and G.-H. Chang. 1995. <span>“A Comparative Study of Some Rank Tests for Interaction.”</span> <em>Computational Statistics &amp; Data Analysis</em> 19 (1): 85–96. <a href="https://doi.org/10.1016/0167-9473(93)E0045-6">https://doi.org/10.1016/0167-9473(93)E0045-6</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>